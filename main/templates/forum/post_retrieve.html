{% block postview %}
{% load staticfiles %}
{% load avatar_tags %}
{% load bleach_tags %}
{% load permissions %}

<div style="background-color:wheat; margin-left: 0; margin-bottom: 30px">
    <!--
    <p>Title: {{post.title}}</p>
    <p>Created by {{post.created_by}} </p>
    <p>Created at {{post.created_at}} </p>
    <p>Content: {{post.content}}</p>
    <p>Upvote: {{post.num_upvotes}}</p>
    <p>Downvote: {{post.num_downvotes}}</p>
    <p><a href="{% url 'forum:post_update' forum.id topic.id post.id %}">Edit this post</a></p>
    <p><a href="{% url 'forum:post_create' forum.id topic.id post.id %}">Comment this post</a></p>
    <p><a href="{% url 'forum:vote_create' post.id %}?type=u">Upvote</a>|
       <a href="{% url 'forum:vote_create' post.id %}?type=d">Downvote</a></p>
    -->
    <div class="panel panel-default post-outer-wrapper">
        {% if not is_child %}
            <div class="forum-group-head">
                <div>
                    <div class="post-heading-title">
                        {{post.title}}
                    </div>
                    <div class="post-heading-created-time">
                        {{post.created_at}}
                    </div>
                </div>
            </div>
        {% endif %}
        <div class="row post-wrapper" id="post-{{ post.id }}">
            <div class="post-row-same-height">
                <div class="col-md-height post-user-detail ">
                    <div>
                        <div class = "post-user-name">
                            <a href="{{post.created_by.get_absolute_url}}" class="post-username">
                                {{post.created_by}}
                            </a>
                        </div>
                        <div>
                            <img class="post-user-avatar" src="{% avatar_url post.created_by 200 %}" alt="user-avatar" data-holder-rendered="true" align="middle">
                            </div>
                    </div>
                </div>
                <div class="post-content col-md-height">
                    <div class="post-body">
                        <div class="post-content">
                            <div style="margin-left:1em; margin-top: 1em; margin-bottom:1em;">
                                {{post.content|bleach}}
                            </div>
                        </div>
                    </div>
                    <div class="post-tools">
                        <div class="row">
                            <div class="col-md-9">
                                <a class="btn btn-default post-reply" href="{% url 'forum:post_create' forum.id topic.id post.id %}" role="button">
                                  Reply
                                </a>
                                {% ifhasperm "post_permission.can_update_post" request.user post %}
                                    <a class="btn btn-default post-edit" href="{% url 'forum:post_update' forum.id topic.id post.id %}" role="button">
                                      Edit
                                    </a>
                                {% endifhasperm %}
                                  <a class="btn btn-default post-edit" href="{% url 'forum:topic_retrieve' forum.id topic.id %}#post-{{ post.id }}" role="button">
                                    #
                                  </a>
                            </div>
                            <div class="col-md-1">
                                <a class="btn btn-default post-upvote" href="{% url 'forum:vote_create' post.id %}?type=u" role="button">
                                  +
                                </a>
                            </div>
                            <div class="col-md-1 post-count-upvote" id = "count_upvote">
                                {{ post.total_votes }}
                            </div>
                            <div class="col-md-1">
                                <a class="btn btn-default post-downvote" href="{% url 'forum:vote_create' post.id %}?type=d" role="button">
                                  -
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div style="margin-left:50px; margin-top: -1.5em">
{% for p in post.get_reply_posts %}
    {% with post=p template_name="forum/post_retrieve" %}
        {% include 'forum/post_retrieve.html' with is_child=True %}
    {% endwith %}
{% endfor %}
</div>

{% endblock postview %}
{% block extra-js %}
    <script src="{% static 'js/highlight/highlight.pack.js' %}"></script>
    <script>hljs.initHighlightingOnLoad();</script>
{% endblock %}
{% block extra-css %}
    <link rel="stylesheet" href="{% static 'js/highlight/styles/default.css' %}"/>
{% endblock %}